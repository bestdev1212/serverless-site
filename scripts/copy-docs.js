/**
 * Node script to move docs from /node_modules/erverless/doc to /docs
 */
var fs = require('fs')
var path = require('path')
var originalDocPath = path.join(__dirname, '/../lib/plugins/aws')
var dest = path.join(__dirname, '/../docs/aws/cli')

function getSubFolders(dir) {
  return fs.readdirSync(dir).filter(function (x) {
    return x !== '.DS_Store' && x !== 'index.js'
  })
}

function getReadMePaths(dir) {
  var readMePaths = getSubFolders(dir).map(function(directory, i){
    return path.join(dir, directory, 'README.md')
  })
  return readMePaths
}

function copyReadMe(p) {
  if (fs.existsSync(p)) {
    var directory = path.basename(path.resolve(p, '..'));
    var newName = directory + '.md'
    var newPath = path.join(dest, newName)
    var content = fs.readFileSync(p)

var contentToWrite =`--- This file is automatically generated from lib/plugins/aws/${directory}/README.md Please edit it to update this doc ---
${content}`
    fs.writeFileSync(newPath, contentToWrite);
    //fs.createReadStream(p).pipe(fs.createWriteStream(newPath));
  }
}

var readMeArray = getReadMePaths(originalDocPath)
for (var i = 0; i < readMeArray.length; i++) {
  copyReadMe(readMeArray[i])
}
